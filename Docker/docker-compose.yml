version: "3"
services:
  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    hostname: grafana
    restart: unless-stopped
    user: "0"
    volumes:
      - ../Data/grafana:/var/lib/grafana
    environment:
      - "FG_SERVER_ROOT_URL=CHANGEME.example.com"
  influxdb:
    image: influxdb:latest
    container_name: influxdb
    hostname: influxdb
    restart: unless-stopped
    ports:
      - "8086:8086"
    volumes:
      - ../Data/influxdb:/var/lib/influxdb
      - ../Config/influxdb-scripts:/docker-entrypoint-initdb.d
    environment:
      - "INFLUXDB_ADMIN_USER=admin"
      - "INFLUXDB_ADMIN_PASSWORD=changeme"
  nginx:
    image: nginx:latest
    container_name: nginx
    hostname: nginx
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ../Config/nginx.conf:/etc/nginx/nginx.conf
      - ../Data/nginx:/etc/ssl/private
  # Just for collecting sample metrics from this host
  telegraf:
    image: telegraf:latest
    container_name: telegraf
    hostname: telegraf
    restart: unless-stopped
    ports:
      - "8888:8888"
    volumes:
      - "/:/hostfs:ro"
      - "/etc:/hostfs/etc:ro"
      - "/proc:/hostfs/proc:ro"
      - "/sys:/hostfs/sys:ro"
      - "/var:/hostfs/var:ro"
      - "/run:/hostfs/run:ro"
      - "../Config/telegraf.conf:/etc/telegraf/telegraf.conf"
      - "/var/run/docker.sock:/var/run/docker.sock:ro"
    environment:
      - "HOST_ETC=/hostfs/etc"
      - "HOST_PROC=/hostfs/proc"
      - "HOST_SYS=/hostfs/sys"
      - "HOST_VAR=/hostfs/var"
      - "HOST_RUN=/hostfs/run"
      - "HOST_MOUNT_PREFIX=/hostfs"
